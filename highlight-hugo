#!/bin/sh
":"; exec emacs --quick --script "$0" -- "$@" # -*- mode: emacs-lisp; lexical-binding: t; -*-
;;; highlight-hugo --- Syntax highlighting for Hugo code blocks
;;; Commentary:
;;
;; This is a command line tool using Emacs in batch mode to render a
;; syntax highlighted version of the input files.
;;
;;; Code:

(defun get-fullpath (relpath)
  "Return the full path of RELPATH, relative to caller's file location."
  (concat (file-name-directory (file-truename load-file-name)) relpath))

(add-to-list 'load-path (get-fullpath "."))
(add-to-list 'load-path (get-fullpath "htmlize"))

(require 'highlight-hugo)

(setq highlight-hugo-help-text "\
Syntax highlight HTML files generated by Hugo using Emacs.

Usage:
    highlight-hugo hugo-publish-dir

where hugo-publish-dir is the public/ directory generated by Hugo.")

(pop argv) ; Remove the -- separator
(if (null command-line-args-left)
    (message highlight-hugo-help-text)
  (highlight-hugo-replace-in-publish-directory (pop argv)))

(kill-emacs 0)

;;; highlight-hugo ends here
